{% extends 'base.html' %}

{% block meta %}
<title>Favorites</title>
{% endblock meta %}

{% block content %}
<div class="container mt-5">
    <h2>Your Favorite Books</h2>
    <div class="row">
        {% for book in karya %}
        <div class="col-md-4">
            <a href="{% url 'main:show_preview' book.pk %}"> 
            <div class="card mb-4">
                <img src="{{ book.gambar }}" class="card-img-top" alt="{{ book.judul }}">
                <div class="card-body small-card-body" >
                    <h5 class="card-title">{{ book.judul }}</h5>
                    <p class="card-text">Author: {{ book.penulis }}</p>
                    <p class="card-text">Pages: {{ book.jumlah_halaman }}</p>
                    <p class="card-text">Language: {{ book.bahasa }}</p>
                    <p class="card-text">Publisher: {{ book.penerbit }}</p>
                    <p class="card-text">Rating: {{ book.rating }}</p>
                    <a href="{% url 'modul_favorites:remove_favorites' book.pk %}" class="btn btn-danger">Remove from Favorites</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<style>
    .small-card-body {
        padding: 10px;
    }
</style>

<div class="container mt-4">
    <h1>Remove With Ajax</h1>
    <ul>
        {% for buku in karya %}
            <li>{{ buku.judul }}
                <button class="add-remove-favorite" data-id="{{ buku.pk }}" data-action="{% if request.user in buku.buku_favorites.all %}remove{% else %}add{% endif %}">
                    {% if request.user in buku.buku_favorites.all %}Remove from Favorites{% else %}Add to Favorites{% endif %}
                </button>
            </li>
        {% endfor %}
    </ul>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('.add-remove-favorite').click(function() {
        var button = $(this);
        var id = button.data('id');
        var action = button.data('action');

        $.ajax({
            type: 'POST',
            url: "{% url 'modul_favorites:toggle_favorites' %}",
            data: {
                id: id,
                action: action,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(response) {
                if (response.status === 'added') {
                    button.data('action', 'remove').text('Remove from Favorites');
                } else if (response.status === 'removed') {
                    button.data('action', 'add').text('Add to Favorites');
                }
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    });
});
</script>
{% endblock content %}
